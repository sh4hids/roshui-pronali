---
import RecipeGrid from '@/components/RecipeGrid.astro';
import { getAllRecipes, getAllRecipesByTag, getUniqueTags } from '@/data';
import BaseLayout from '@/layouts/BaseLayout.astro';
import PageLayout from '@/layouts/PageLayout.astro';
import { generateSlug } from '@/utils';

export const prerender = true;

export async function getStaticPaths() {
  const allRecipes = await getAllRecipes();
  const tags = getUniqueTags(allRecipes);

  return tags.map((tag) => ({
    params: {
      slug: generateSlug(tag),
    },
  }));
}

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

const allRecipes = await getAllRecipes();
const tags = getUniqueTags(allRecipes);
const currentCategory = tags.find((tag) => generateSlug(tag) === slug);
const recipes = getAllRecipesByTag(allRecipes, slug);
const meta = {
  title: currentCategory,
};
---

<BaseLayout meta={meta}>
  <PageLayout title={currentCategory}>
    <RecipeGrid recipes={recipes} />
  </PageLayout>
</BaseLayout>
