---
import RecipeGrid from '@/components/RecipeGrid.astro';
import {
  getAllRecipes,
  getAllRecipesByCategory,
  getUniqueCategories,
} from '@/data';
import AllRecipesPageLayout from '@/layouts/AllRecipesPageLayout.astro';
import { generateSlug } from '@/utils';

export const prerender = true;

export async function getStaticPaths() {
  const allRecipes = await getAllRecipes();
  const categories = getUniqueCategories(allRecipes);

  return categories.map((category) => ({
    params: {
      slug: generateSlug(category),
    },
  }));
}

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

const allRecipes = await getAllRecipes();
const categories = getUniqueCategories(allRecipes);
const currentCategory =
  categories.find((category) => generateSlug(category) === slug) || '';
const recipes = getAllRecipesByCategory(allRecipes, slug);
const meta = {
  title: currentCategory,
};
---

<AllRecipesPageLayout title={currentCategory} description="test">
  <RecipeGrid recipes={recipes} />
</AllRecipesPageLayout>
